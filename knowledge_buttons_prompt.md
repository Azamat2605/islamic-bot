# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ó–Ω–∞–Ω–∏—è¬ª

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏ ¬´–ö–æ—Ä–∞–Ω¬ª –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ó–Ω–∞–Ω–∏—è¬ª Telegram‚Äë–±–æ—Ç–∞. –í—Å–µ –æ—à–∏–±–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å CallbackData, —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ñ–∞–π–ª–æ–≤, —É–∂–µ —É—á—Ç–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.

## –†–∞–±–æ—á–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (–∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∏–∑ –∫–Ω–æ–ø–∫–∏ ¬´–ö–æ—Ä–∞–Ω¬ª)

### 1. **CallbackData‚Äë–∫–ª–∞—Å—Å** (`bot/keyboards/inline/knowledge/main_kb.py`)
```python
from aiogram.filters.callback_data import CallbackData

class KnowledgeCallback(CallbackData, prefix="know"):
    action: str
    section: str | None = None
    page: int | None = None
    surah_id: int | None = None
```
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –ü–æ–ª—è –æ–±—ä—è–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–µ (`:`), –∞ –Ω–µ —á–µ—Ä–µ–∑ –∑–Ω–∞–∫ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ (`=`).
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `= None` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).
- –ü—Ä–µ—Ñ–∏–∫—Å `prefix="know"` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è –º–æ–¥—É–ª—è.

### 2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ** (—Ç–∞–º –∂–µ, –≤ `get_knowledge_main_keyboard()`)
```python
InlineKeyboardButton(
    text=_("üìñ –ö–æ—Ä–∞–Ω"),
    callback_data=KnowledgeCallback(action="section", section="quran").pack()
)
```
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è callback_data –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `KnowledgeCallback(...).pack()`.
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è–º –∫–ª–∞—Å—Å–∞.
- –ó–Ω–∞—á–µ–Ω–∏–µ `action="section"` ‚Äì –æ–±—â–µ–µ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ ¬´–ó–Ω–∞–Ω–∏—è¬ª.
- –ó–Ω–∞—á–µ–Ω–∏–µ `section` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"quran"`, `"hadith"`, `"books"`).

### 3. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏** (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä `bot/handlers/sections/knowledge/quran/catalog.py`)
```python
from aiogram import Router
from aiogram.types import CallbackQuery
from bot.keyboards.inline.knowledge.main_kb import KnowledgeCallback

router = Router(name="quran_catalog")

@router.callback_query(KnowledgeCallback.filter(action="section", section="quran"))
async def quran_entry(callback: CallbackQuery, callback_data: KnowledgeCallback):
    # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    ...
```
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –§–∏–ª—å—Ç—Ä –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã**, –∞ –Ω–µ —Å–ª–æ–≤–∞—Ä—å –∏ –Ω–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Å `F`.
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `KnowledgeCallback.filter(action="section", section="quran")`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `KnowledgeCallback.filter({"action": "section", "section": "quran"})`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `KnowledgeCallback.filter((F.action == "section") & (F.section == "quran"))`

### 4. **–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ ¬´–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ¬ª** (`bot/handlers/sections/knowledge/menu.py`)
–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–Ω–æ–ø–∫–∏ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
```python
@router.callback_query(KnowledgeCallback.filter(action="section"))
async def knowledge_section_handler(
    callback: CallbackQuery,
    callback_data: KnowledgeCallback
):
    if callback_data.section == "quran":
        return  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, —Ç.–∫. —É –ö–æ—Ä–∞–Ω–∞ —Å–≤–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ¬ª
```
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å `callback_data.section` –∏ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∫–Ω–æ–ø–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —Å–≤–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.
- –î–ª—è –∫–Ω–æ–ø–æ–∫‚Äë–∑–∞–≥–ª—É—à–µ–∫ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

---

## –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏

**–ó–∞–º–µ–Ω–∏—Ç–µ `{SECTION}` –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ —Ä–∞–∑–¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `hadith`, `books`, `articles`).**

### –®–∞–≥ 1. –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
–í —Ñ–∞–π–ª–µ `bot/keyboards/inline/knowledge/main_kb.py` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_knowledge_main_keyboard()` –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É:
```python
InlineKeyboardButton(
    text=_("üìú –•–∞–¥–∏—Å—ã"),  # –ò–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ —ç–º–æ–¥–∑–∏
    callback_data=KnowledgeCallback(action="section", section="{SECTION}").pack()
)
```

### –®–∞–≥ 2. –°–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≥–æ—Ç–æ–≤)
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `bot/handlers/sections/knowledge/{SECTION}/catalog.py` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π) —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
```python
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ {–ù–∞–∑–≤–∞–Ω–∏–µ}.
"""
import logging
from aiogram import Router
from aiogram.types import CallbackQuery
from bot.keyboards.inline.knowledge.main_kb import KnowledgeCallback

logger = logging.getLogger(__name__)
router = Router(name="{SECTION}_catalog")

@router.callback_query(KnowledgeCallback.filter(action="section", section="{SECTION}"))
async def {SECTION}_entry(callback: CallbackQuery, callback_data: KnowledgeCallback):
    try:
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å
        await callback.message.edit_text(
            text="üìö **{–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞}**\n\n–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞–∑–¥–µ–ª–∞...",
            reply_markup=...  # –≤–∞—à–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        )
        await callback.answer()
    except Exception as e:
        logger.error(f"Error in {SECTION}_entry: {e}")
        await callback.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.", show_alert=True)
```

### –®–∞–≥ 3. –ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞–≥–ª—É—à–∫—É (–µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ –≥–æ—Ç–æ–≤)
–ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª –µ—â—ë –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ ‚Äì –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `menu.py` —É–∂–µ –ø–æ–∫–∞–∂–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ¬ª.

### –®–∞–≥ 4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–æ—É—Ç–µ—Ä –ø–æ–¥–∫–ª—é—á—ë–Ω
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–æ—É—Ç–µ—Ä –≤–∞—à–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –±–æ—Ç–∞ (–æ–±—ã—á–Ω–æ –≤ `bot/core/loader.py` –∏–ª–∏ `bot/handlers/sections/knowledge/__init__.py`).

---

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|--------|---------|-------------|
| `TypeError: unexpected keyword argument` | –ü–æ–ª—è –∫–ª–∞—Å—Å–∞ –æ–±—ä—è–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ `=` –≤–º–µ—Å—Ç–æ `:` | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `action: str`, –∞ –Ω–µ `action = str` |
| –ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–∏–ª—å—Ç—Ä–∞ | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `KnowledgeCallback.filter(action="...", section="...")` |
| `AttributeError: 'dict' object has no attribute 'resolve'` | –§–∏–ª—å—Ç—Ä –ø–µ—Ä–µ–¥–∞–Ω –∫–∞–∫ —Å–ª–æ–≤–∞—Ä—å | –ó–∞–º–µ–Ω–∏—Ç–µ `.filter({...})` –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ | –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ª–æ–≤—è—Ç –æ–¥–∏–Ω callback | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `section` |

---

## –ü—Ä–∏–º–µ—Ä –≥–æ—Ç–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏ ¬´–•–∞–¥–∏—Å—ã¬ª

1. **–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:**
```python
InlineKeyboardButton(
    text=_("üìú –•–∞–¥–∏—Å—ã"),
    callback_data=KnowledgeCallback(action="section", section="hadith").pack()
)
```

2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ (–∑–∞–≥–ª—É—à–∫–∞):** –£–∂–µ –µ—Å—Ç—å –≤ `menu.py` ‚Äì –ø–æ–∫–∞–∂–µ—Ç ¬´–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ¬ª.

3. **–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** —Å–æ–∑–¥–∞–π—Ç–µ `hadith/catalog.py` —Å —Ñ–∏–ª—å—Ç—Ä–æ–º `section="hadith"`.

---

## –ò—Ç–æ–≥
–°–ª–µ–¥—É—è —ç—Ç–æ–º—É –ø—Ä–æ–º–ø—Ç—É, –≤—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ–∑–¥–∞–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É –±–µ–∑ –æ—à–∏–±–æ–∫ CallbackData, —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π —Ä–∞–∑–¥–µ–ª–∞ ¬´–ó–Ω–∞–Ω–∏—è¬ª.
